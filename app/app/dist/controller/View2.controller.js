sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","../model/formatter","sap/ui/model/message/MessageModel","sap/m/MessagePopover","sap/m/MessageItem","sap/ui/core/Core"],function(e,t,o,s,a,r,n,i,u){"use strict";return e.extend("app.controller.View2",{onInit:function(){this.loaddata();var e=sap.ui.getCore().getMessageManager(),t=e.getMessageModel(),o=t.bindList("/",undefined,[]);this.getView().setModel(t,"message");o.attachChange(this.onMessageBindingChange,this);this._bTechnicalErrors=false;var s=this.getOwnerComponent().getModel("authors");s.attachDataReceived(function(){debugger})},onMessageBindingChange:function(e){var o=e.getSource().getContexts(),s,a=false;if(a||!o.length){return}s=o.map(function(e){return e.getObject()});sap.ui.getCore().getMessageManager().removeMessages(s);this._bTechnicalErrors=true;t.error(s[0].message,{id:"serviceErrorMessageBox",onClose:function(){a=false}});a=true},loaddata(){var e=this.getOwnerComponent().getModel("authors");var t=e.bindContext("/Authors(ID=150)/books",{$$patchWithoutSideEffects:true});t.requestObject().then(e=>{var t=new o;t.setData(e);this.getView().setModel(t,"localDataModel")})},generateNew:function(){var e=new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/admin/",synchronizationMode:"None",operationMode:"Server",autoExpandSelect:true,earlyRequests:true,updateGroupId:"myGroup"});var o=e.bindList("/Authors(ID=150)/books");var s=[{ID:20737,title:"avinash Book",stock:2222},{ID:2037,title:"avinash Book3",stock:223322}];var s=[{ID:20737,title:"avinash Book",stock:2222},{ID:2037,title:"avinash Book3",stock:223322}];var a=[];a.push(u);a.push(g);var r=e.bindContext(`/Authors(ID=101)`);var n=e.bindList(`/Bonus`);var i=e.bindContext(`/Books(ID=201)`);var u=i.getBoundContext().setProperty("title","alphasBetas");var g=r.getBoundContext().setProperty("name","editPrmise");var d=[{ID:1,name:"Bon"},{ID:2,name:"Bo2"}];d.forEach(e=>{var t=n.create(e).created();a.push(t)});s.forEach(e=>{var t=o.create(e).created();a.push(t)});Promise.all(a).then(e=>{t.success("creation succcessfull");this.loaddata()}).catch(e=>{t.error(e.error.message)});e.submitBatch("myGroup")},handleMessagePopoverPress:function(e){if(!this.oMP){this.createMessagePopover()}this.oMP.toggle(e.getSource())},createMessagePopover:function(){var e=this;this.oMP=new n({activeTitlePress:function(t){var o=t.getParameter("item"),s=e.getView().byId("messageHandlingPage"),a=o.getBindingContext("message").getObject(),r=Element.registry.get(a.getControlId());if(r){s.scrollToElement(r.getDomRef(),200,[0,-100]);setTimeout(function(){r.focus()},300)}},items:{path:"message>/",template:new i({title:"{message>message}",subtitle:"{message>additionalText}",groupName:{parts:[{path:"message>controlIds"}],formatter:this.getGroupName},activeTitle:{parts:[{path:"message>controlIds"}],formatter:this.isPositionable},type:"{message>type}",description:"{message>message}"})},groupItems:true});this.getView().byId("messagePopoverBtn").addDependent(this.oMP)},_getMessagePopover:function(){var e=this.getView();if(!this._pMessagePopover){this._pMessagePopover=s.load({id:e.getId(),name:"app.fragments.MessagePopover"}).then(function(t){e.addDependent(t);return t})}return this._pMessagePopover},onMessagePopoverPress:function(e){var t=e.getSource();this._getMessagePopover().then(function(e){e.openBy(t)})},getAndCreateBonus(){var e=this.getOwnerComponent().getModel("authors");var o=e.bindContext(`/Bonus`);o.requestObject("value").then(function(e){});var s=e.bindList(`/Bonus`);var a=[];var r=[{ID:1,name:"Bon"},{ID:2,name:"Bo2"}];r.forEach(e=>{var t=s.create(e).created();a.push(t)});Promise.all(a).then(e=>{t.success("creation succcessfull");this.loaddata();this.RefreshBonus()}).catch(e=>{t.error(e.error.message)})},getAndUpdateBonus(){var e=new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/admin/",synchronizationMode:"None",operationMode:"Server",autoExpandSelect:true,earlyRequests:true,updateGroupId:"myGroup2"});var o=new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/admin/",synchronizationMode:"None",operationMode:"Server",autoExpandSelect:true,earlyRequests:true,updateGroupId:"myGroup22"});var s=e.bindContext(`/Bonus(ID=1)`);Promise.all([s.getBoundContext().setProperty("name","Tes")]).then(()=>{debugger;this.RefreshBonus()}).catch(e=>{t.error("errorPay.error.message")});e.submitBatch("myGroup2")},DeleteBonus:function(){var e=this.getOwnerComponent().getModel("authors");Promise.all([e.delete(`/Bonus(ID=1)`)]).then(e=>{debugger;this.RefreshBonus()}).catch(e=>{debugger})},RefreshBonus:function(){this.getOwnerComponent().getModel("authors").refresh()},ResetBonus:function(){var e=this.getOwnerComponent().getModel("authors");Promise.all([e.delete(`/Bonus(ID=1)`),e.delete(`/Bonus(ID=2)`)]).then(e=>{debugger;this.RefreshBonus()}).catch(e=>{debugger})},EditBonus:function(){var e=this.getOwnerComponent().getModel("authors");var t=e.bindContext(`/Bonus(ID=1)`);Promise.all([t.getBoundContext().setProperty("name","Tes")]).then(()=>{debugger;this.RefreshBonus()}).catch(e=>{debugger})},UseSetValue:function(){var e=this.getOwnerComponent().getModel("authors");var t=e.bindList("/Bonus");t.requestContexts().then(function(t,o){debugger;var s=e.bindProperty(`/Bonus(ID=1)/name`,t[0],{$$noPatch:true});Promise.all([s.setValue("Tester")]).then(()=>{debugger;this.RefreshBonus()}).catch(e=>{debugger})})},customLogics:function(){sap.ui.require(["sap/base/util/each","sap/base/util/array/diff"],function(e,t){e(["1","8","7"],function(e,t){console.log("position: "+e+", value: "+t)});e({name:"me",age:32},function(e,t){console.log("key: "+e+", value: "+t)});var o=[{ID:20737,title:"avinash Book",stock:2222},{ID:2037,title:"avinash Book3",stock:223322}];var s=[{ID:20737,title:"Kumar",stock:2221},{ID:2037,title:"avinash Book3",stock:1312}];var a=t(o,s);debugger})},postFunctionImports(){var e=new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/browse/",synchronizationMode:"None",operationMode:"Server",autoExpandSelect:true,earlyRequests:true,updateGroupId:"fullCreateSync",httpHeaders:{customAvinash:"avinash"}});var o=e.bindContext("/ChangeBonusByID(...)");o.setProperty("ID",2);o.setProperty("quantity",2);o.execute().then(()=>{t.success(aContexts)})}})});